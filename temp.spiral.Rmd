---
title: "Climate Sprial"
author: "Ronan McKeown"
date: "2023-12-19"
output: html_document
---

## Setting up the project

Install Packages

```{r}
##proviidng a mirror to install package
options(repos = c(CRAN = "https://cloud.r-project.org"))

install.packages("ggplot2")
install.packages("readr")
install.packages("tidyverse")

library(ggplot2)
library(readr)
library(tidyverse)
```

Read CSV data File and clean data

```{r}
# Instead of using setwd(), specify the full path directly
input_path <- "C:/Users/name/folder/file.name.csv

# Read data using the specified path
t_diff <- read.csv(input_path, skip = 1, na = "***") %>%
  select(year = Year, all_of(month.abb)) %>%
  pivot_longer(-year, names_to = "month", values_to = "t_diff") %>%
  drop_na()

print(t_diff)
```

Creating connections points in spiral (last December and next January)  
  
This is how we will get the lines to connect from:  
* January of year x to December of x - 1  
* December of year y to January of y + 1

```{r}
# last_dec <- t_diff %>%
#   filter(month == "Dec") %>%
#   mutate(year = year + 1,
#          month = "last_Dec")

next_jan <- t_diff %>%
  filter(month == "Jan") %>%
  mutate(year = year - 1,
         month = "next_Jan")

# print(last_dec)
print(next_jan)
```

binding data with connectors in long row data

```{r}
# t_data <- bind_rows(last_dec, t_diff, next_jan) %>%
t_data <- bind_rows(t_diff, next_jan) %>% 
 mutate(month = factor(month, level = c("last_Dec", month.abb, "next_Jan")),
         month_number = as.numeric(month) -1,
         this_year = year == 2022)

print(t_data)
```

```{r}
annotation <- t_data %>%
  slice_max(year) %>%
  slice_max(month_number)
```

## Plotting line grapgh of yearly temperature data on xy axis 

```{r}
t_data %>%
  ggplot(aes(x = month_number, y = t_diff, group = year, 
             colour = year, size = this_year)) +
  geom_hline(yintercept = 0, colout = "white") +
  geom_line() +
  geom_text(data = annotation,
             aes(x = month_number, y = t_diff, label = year, color = year),
             inherit.aes = FALSE,
             hjust = 0, size = 5, nudge_x = 0.15, frontface = "bold") +
  scale_x_continuous(breaks = 1:12,
                     labels=month.abb,
                     sec.axis = dup_axis(name = NULL, labels = NULL)) +
  scale_y_continuous(breaks = seq(-2, 2, 0.2),
                     sec.axis = dup_axis(name = NULL, labels = NULL)) +
  scale_size_manual(breaks = c(FALSE, TRUE),
                    values = c(0.25, 1), guide = "none") +
  scale_color_viridis_c(breaks = seq(1880, 2020, 20),
                        guide = guide_colorbar(frame.color = "white",
                                               frame.linewidth = 1)) +
  coord_cartesian(xlim = c(1,12)) +
  labs(x = NULL,
       y = "Temperature change since pre-industrial time [\u00B0c]",
       title = "Global temperature cange since 1880 by month"
       ) +
  theme(
    panel.background = element_rect(fill = "black", color = "white", size = 1),
    plot.background = element_rect(fill = "#444444"), 
    panel.grid = element_blank(),
    axis.text = element_text(color = "white", size = 13),
    axis.ticks = element_line(colour = "white"),
    axis.ticks.length = unit(-5, "pt"),
    axis.title = element_text(colour = "white", size = 13),
    plot.title = element_text(colour = "white", hjust = 0.5, size = 15)
    )
```


## Plotting cartisian grapgh of yearly temperature data 

creating temp ring lables

```{r}
temp_lines <- tibble(
  x = 1,
  y = c(1.5, 2.0),
  labels = c("1.5\u00B0C", "2.0\u00B0C"))

```


```{r}
t_data %>%
  ggplot(aes(x = month_number, y = t_diff, group = year, colour = year)) +
  geom_hline(yintercept = c(1.5, 2.0), color = "red") +
  geom_line() +
  geom_label(data = temp_lines, aes(x=x, y=y, label = labels), 
             color = "red", fill = "black", label.size = 0,
             inherit.aes = FALSE) +
  scale_x_continuous(breaks = 1:12,
                     labels=month.abb, expand = c(0,0),
                     sec.axis = dup_axis(name = NULL, labels = NULL)) +
  scale_y_continuous(breaks = seq(-2, 2, 0.2),
                     limits = c(-2, 2.7), expand = c(0, -0.7),
                     sec.axis = dup_axis(name = NULL, labels = NULL)) +
  scale_color_viridis_c(breaks = seq(1880, 2020, 20),
                        guide = "none") +

  coord_polar() +
  labs(x = NULL,
       y = NULL,
       title = "Global temperature cange (1880-2022)"
       ) +
  theme(
    panel.background = element_rect(fill = "black"),
    plot.background = element_rect(fill = "#444444", color = "#444444"), 
    panel.grid = element_blank(),
    axis.text = element_text(color = "white", size = 13),
    axis.text.y = element_blank(),
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    plot.title = element_text(colour = "white", hjust = 0.5, size = 15))
```

